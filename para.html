<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Para Ä°ÅŸlemleri - Mobil BankacÄ±lÄ±k</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to bottom right, #e0f7fa, #ffffff);
    margin: 0; padding: 0;
  }
  .container {
    max-width: 500px;
    margin: 20px auto;
    padding: 20px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  input, button {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1em;
  }
  button {
    background: #00796b;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background: #004d40;
  }
  nav {
    background: #00796b;
    color: white;
    padding: 10px;
    text-align: center;
  }
  nav a {
    color: white;
    margin: 0 15px;
    text-decoration: none;
    font-weight: bold;
  }
  .faiz-bilgisi {
    margin-top: 15px;
    font-weight: bold;
    color: #004d40;
  }
</style>
</head>
<body>

<nav>
  <a href="para.html" style="text-decoration: underline;">Para</a>
  <a href="doviz.html">DÃ¶viz</a>
  <a href="profil.html">Profil</a>
  <a href="gecmis.html">Hesap GeÃ§miÅŸi</a>
  <button onclick="logout()" style="float:right; margin-right:15px; background:#c62828;">Ã‡Ä±kÄ±ÅŸ</button>
</nav>

<div class="container">
  <h3>ðŸ’° Para Ä°ÅŸlemleri</h3>
  <input type="number" id="deposit" placeholder="YatÄ±rÄ±lacak Tutar (TL)" />
  <button onclick="yatir()">Para YatÄ±r</button>
  <input type="number" id="withdraw" placeholder="Ã‡ekilecek Tutar (TL)" />
  <button onclick="cek()">Para Ã‡ek</button>

  <p><strong>Bakiye:</strong> <span id="bakiye">0.00</span> TL</p>

  <!-- Faiz oranÄ± inputu -->
  <input type="number" id="faizOrani" placeholder="GÃ¼nlÃ¼k Faiz OranÄ± (%)" min="0" step="0.01" />
  <p class="faiz-bilgisi">Toplam Faiz Getirisi: <span id="faizGetirisi">0.00</span> TL</p>
</div>

<script>
  let currentUser = localStorage.getItem('currentUser');
  if(!currentUser) {
    alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±nÄ±z!');
    window.location.href = 'login.html';
  }

  let users = JSON.parse(localStorage.getItem('users')) || {};
  let userData = users[currentUser];
  if(!userData) {
    alert('KullanÄ±cÄ± bulunamadÄ±!');
    localStorage.removeItem('currentUser');
    window.location.href = 'login.html';
  }

  // BaÅŸlangÄ±Ã§ deÄŸerleri
  if(userData.interest === undefined) userData.interest = 0;
  if(!userData.lastInterestDate) userData.lastInterestDate = new Date().toISOString();

  // Faiz oranÄ± inputuna kayÄ±tlÄ± son faiz oranÄ±nÄ± koy (eÄŸer varsa)
  document.getElementById('faizOrani').value = userData.dailyInterestRate || '';

  // Fonksiyonlar
  function yatir(){
    let val = parseFloat(document.getElementById('deposit').value);
    if(isNaN(val) || val <= 0) return alert('GeÃ§erli bir tutar giriniz!');
    userData.balance += val;
    addTransaction('Para YatÄ±rma', val);
    saveData();
    updateUI();
  }

  function cek(){
    let val = parseFloat(document.getElementById('withdraw').value);
    if(isNaN(val) || val <= 0) return alert('GeÃ§erli bir tutar giriniz!');
    if(userData.balance < val) return alert('Yetersiz bakiye!');
    userData.balance -= val;
    addTransaction('Para Ã‡ekme', val);
    saveData();
    updateUI();
  }

  function otomatikFaizEkle() {
    let faizOrani = parseFloat(document.getElementById('faizOrani').value);
    if(isNaN(faizOrani) || faizOrani < 0) return; // geÃ§erli faiz yoksa iÅŸlem yok

    let sonFaiz = new Date(userData.lastInterestDate);
    let simdi = new Date();
    let farkMs = simdi - sonFaiz;
    const birGunMs = 24 * 60 * 60 * 1000;

    if(farkMs >= birGunMs){
      let gunSayisi = Math.floor(farkMs / birGunMs);
      let toplamFaiz = 0;

      for(let i=0; i < gunSayisi; i++){
        let faiz = userData.balance * (faizOrani / 100);
        userData.balance += faiz;
        userData.interest += faiz;
        toplamFaiz += faiz;
        addTransaction('Otomatik GÃ¼n Sonu Faiz', faiz);
      }

      userData.lastInterestDate = new Date(sonFaiz.getTime() + gunSayisi * birGunMs).toISOString();
      userData.dailyInterestRate = faizOrani; // GÃ¼nlÃ¼k faiz oranÄ±nÄ± kaydet
      saveData();
      updateUI();
      alert(`${gunSayisi} gÃ¼n iÃ§in toplam ${toplamFaiz.toFixed(2)} TL faiz eklendi.`);
    } else {
      userData.dailyInterestRate = faizOrani; // GÃ¼nlÃ¼k faiz oranÄ±nÄ± kaydet (faiz eklenmese de)
      saveData();
    }
  }

  function addTransaction(type, amount){
    userData.transactions = userData.transactions || [];
    userData.transactions.push({
      type,
      amount,
      date: new Date().toLocaleString()
    });
  }

  function saveData(){
    users[currentUser] = userData;
    localStorage.setItem('users', JSON.stringify(users));
  }

  function updateUI(){
    document.getElementById('bakiye').textContent = userData.balance.toFixed(2);
    document.getElementById('faizGetirisi').textContent = (userData.interest || 0).toFixed(2);
  }

  updateUI();

  // Sayfa yÃ¼klendiÄŸinde otomatik faiz ekle
  window.onload = function(){
    otomatikFaizEkle();
  }

  function logout(){
    localStorage.removeItem('currentUser');
    alert('BaÅŸarÄ±yla Ã§Ä±kÄ±ÅŸ yaptÄ±nÄ±z!');
    window.location.href = 'login.html';
  }
</script>

</body>
</html>
